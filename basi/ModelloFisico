
MODELLO FISICO 

CREATE TABLE Utente (
    Matricola CHAR(9) PRIMARY KEY,
    Nome VARCHAR,
    Cognome VARCHAR,
    Data_Nascita DATE
);

CREATE TABLE Autore (
    username VARCHAR UNIQUE,
    Matricola VARCHAR UNIQUE,
    Password VARCHAR,
	CONSTRAINT autore_uk UNIQUE(username, matricola),
    CONSTRAINT autore_fk FOREIGN KEY (Matricola) REFERENCES Utente(Matricola),
    CONSTRAINT autore_pk PRIMARY KEY(username,Matricola)
);

CREATE TABLE Testo (
    id_Testo SERIAL PRIMARY KEY
);

CREATE TABLE Pagina (
    Titolo VARCHAR PRIMARY KEY,
    Data_creazione DATE DEFAULT CURRENT_DATE,
    Ora_creazione TIME DEFAULT CURRENT_TIME,
    Data_aggiornamento DATE DEFUALT CURRENT_DATE,
    Ora_aggiornamento TIME DEFAULT CURRENT_TIME,
    Matricola VARCHAR NOT NULL,
    login VARCHAR NOT NULL,
    id_Testo INT NOT NULL,
    CONSTRAINT pagina_fk1 FOREIGN KEY (Matricola) REFERENCES Autore(Matricola),
    CONSTRAINT pagina_fk2 FOREIGN KEY (username) REFERENCES Autore(login),
    CONSTRAINT pagina_fk3 FOREIGN KEY (id_Testo) REFERENCES Testo(id_Testo)
);

CREATE TABLE Frase (
    id_Frase SERIAL PRIMARY KEY,
    ordine int
);
CREATE TABLE Versione(
	testo VARCHAR,
	num_versione int,
	id_frase int,
	CONSTRAINT frase_fk FOREIGN KEY (id_frase) REFERENCES Frase(id_frase),
	CONSTRAINT frase_pk PRIMARY KEY(id_frase, num_versione)
);

CREATE TYPE Stato_proposta AS ENUM ('non inviato', 'inviato', 'accettato', 'rifiutato');
CREATE TABLE Proposta (
    Id_Proposta SERIAL PRIMARY KEY,
    Data DATE DEFAULT CURRENT_DATE,
    Ora TIME DEFAULT CURRENT_TIME,
    Stato STATO_PROPOSTA DEFAULT 'non inviato',
    Titolo VARCHAR NOT NULL,
    login VARCHAR NOT NULL,
    Matricola_autore VARCHAR NOT NULL,
    Matricola VARCHAR NOT NULL,
    CONSTRAINT proposta_fk1 FOREIGN KEY (login) REFERENCES Autore(username),
    CONSTRAINT proposta_fk2 FOREIGN KEY (Matricola_autore) REFERENCES Autore(Matricola),
    CONSTRAINT proposta_fk3 FOREIGN KEY (Matricola) REFERENCES Utente(Matricola),
    CONSTRAINT proposta_fk4 FOREIGN KEY (Titolo) REFERENCES Pagina(Titolo)
);


CREATE TABLE Modifica (
    id_Modifica SERIAL PRIMARY KEY,
    Frase_Proposta VARCHAR,
    id_Frase INT,
    id_Proposta INT,
    CONSTRAINT modifica_fk1 FOREIGN KEY (id_Frase) REFERENCES Frase(id_Frase),
    CONSTRAINT modifica_fk2 FOREIGN KEY (id_Proposta) REFERENCES Proposta(Id_Proposta)
);

CREATE TABLE Collegamento (
    id_Collegamento SERIAL PRIMARY KEY,
    id_Frase INT,
    Titolo VARCHAR,
	CONSTRAINT collegamento_fk1 FOREIGN KEY (id_Frase) REFERENCES Frase(id_Frase),
    CONSTRAINT collegamento_fk2 FOREIGN KEY (Titolo) REFERENCES Pagina(Titolo)
    
);


